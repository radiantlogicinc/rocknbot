# Build stage: install dependencies with uv
FROM python:3.10-slim AS builder

# Install uv
COPY --from=ghcr.io/astral-sh/uv:latest /uv /usr/local/bin/uv

WORKDIR /app

COPY pyproject.toml /app/
RUN --mount=type=cache,target=/root/.cache/uv \
    uv pip install --system .

COPY src /app/src
RUN mkdir -p /app/app_envfiles
RUN touch /app/app_envfiles/lil-lisa.env

ENV PYTHONUNBUFFERED=1

# Final stage: minimal runtime
FROM python:3.10-slim

COPY --from=builder /usr/local/lib/python3.10/site-packages /usr/local/lib/python3.10/site-packages
COPY --from=builder /app /app

ENV PYTHONUNBUFFERED=1
WORKDIR /app

ENTRYPOINT ["python", "-O", "src/slack.py"]
